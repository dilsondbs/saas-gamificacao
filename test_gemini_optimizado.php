<?php

/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘   TESTE GEMINI OTIMIZADO - Validar Melhorias                â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

require __DIR__ . '/vendor/autoload.php';

$app = require_once __DIR__ . '/bootstrap/app.php';
$kernel = $app->make(Illuminate\Contracts\Console\Kernel::class);
$kernel->bootstrap();

echo "\n";
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n";
echo "â•‘         TESTE GEMINI OTIMIZADO - NOVA CONFIGURAÃ‡ÃƒO          â•‘\n";
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";
echo "\n";

echo "ðŸ“Š OTIMIZAÃ‡Ã•ES APLICADAS:\n";
echo "   âœ… Limite de conteÃºdo: 800 â†’ 15,000 caracteres\n";
echo "   âœ… Temperature: 0.7 â†’ 0.9 (mais criativo)\n";
echo "   âœ… MaxOutputTokens: 8,192 â†’ 32,768 (4x maior!)\n";
echo "   âœ… Prompt melhorado com instruÃ§Ãµes detalhadas\n";
echo "\n";

// Criar conteÃºdo de teste RICO
$richContent = "
GESTÃƒO DE PESSOAS - GUIA COMPLETO

MÃ“DULO 1: FUNDAMENTOS DA GESTÃƒO DE PESSOAS

1.1 IntroduÃ§Ã£o
A gestÃ£o de pessoas Ã© o conjunto de polÃ­ticas e prÃ¡ticas necessÃ¡rias para conduzir os aspectos relacionados Ã s pessoas no trabalho, incluindo recrutamento, seleÃ§Ã£o, treinamento, recompensas e avaliaÃ§Ã£o de desempenho.

1.2 Objetivos EstratÃ©gicos
Os principais objetivos da gestÃ£o de pessoas sÃ£o:
- Alinhar os objetivos individuais com os objetivos organizacionais
- Desenvolver competÃªncias dos colaboradores
- Criar ambiente motivador e produtivo
- Reter talentos e reduzir turnover
- Promover cultura organizacional positiva

1.3 Processos Fundamentais
A gestÃ£o de pessoas engloba seis processos principais:
1. Agregar pessoas (recrutamento e seleÃ§Ã£o)
2. Aplicar pessoas (orientaÃ§Ã£o e modelagem do trabalho)
3. Recompensar pessoas (remuneraÃ§Ã£o e benefÃ­cios)
4. Desenvolver pessoas (treinamento e carreira)
5. Manter pessoas (seguranÃ§a e qualidade de vida)
6. Monitorar pessoas (avaliaÃ§Ã£o de desempenho)

MÃ“DULO 2: RECRUTAMENTO E SELEÃ‡ÃƒO

2.1 Planejamento de RH
Antes de recrutar, Ã© essencial:
- Analisar a necessidade real da vaga
- Definir perfil do candidato ideal
- Estabelecer critÃ©rios de seleÃ§Ã£o
- Definir orÃ§amento disponÃ­vel

2.2 TÃ©cnicas de Recrutamento
Recrutamento Interno:
- PromoÃ§Ãµes e transferÃªncias
- Banco de talentos interno
- Programas de desenvolvimento

Recrutamento Externo:
- AnÃºncios em portais de emprego
- Redes sociais profissionais (LinkedIn)
- Empresas de headhunting
- IndicaÃ§Ãµes de funcionÃ¡rios

2.3 Processo Seletivo
Etapas tÃ­picas:
1. Triagem de currÃ­culos
2. Testes tÃ©cnicos e comportamentais
3. Entrevistas por competÃªncias
4. VerificaÃ§Ã£o de referÃªncias
5. Exames mÃ©dicos admissionais
6. Proposta e negociaÃ§Ã£o

MÃ“DULO 3: DESENVOLVIMENTO ORGANIZACIONAL

3.1 Treinamento e CapacitaÃ§Ã£o
Tipos de treinamento:
- IntegraÃ§Ã£o (onboarding)
- TÃ©cnico (habilidades especÃ­ficas)
- Comportamental (soft skills)
- LideranÃ§a e gestÃ£o

3.2 AvaliaÃ§Ã£o de Desempenho
MÃ©todos modernos:
- AvaliaÃ§Ã£o 360 graus
- OKRs (Objectives and Key Results)
- Feedback contÃ­nuo
- Conversas de performance

3.3 Plano de Carreira
Elementos essenciais:
- Mapeamento de competÃªncias
- Trilhas de desenvolvimento
- SucessÃ£o de lideranÃ§as
- Programas de mentoria

MÃ“DULO 4: REMUNERAÃ‡ÃƒO E BENEFÃCIOS

4.1 Estrutura Salarial
- Pesquisa de mercado
- Cargos e salÃ¡rios
- Faixas salariais
- MÃ©rito e promoÃ§Ãµes

4.2 BenefÃ­cios
Essenciais:
- Vale-transporte
- Vale-alimentaÃ§Ã£o
- Plano de saÃºde
- Seguro de vida

EstratÃ©gicos:
- ParticipaÃ§Ã£o nos lucros (PLR)
- Stock options
- PrevidÃªncia privada
- AuxÃ­lio educaÃ§Ã£o

MÃ“DULO 5: CLIMA E CULTURA ORGANIZACIONAL

5.1 Cultura Organizacional
Componentes:
- Valores e crenÃ§as
- Normas e comportamentos
- SÃ­mbolos e rituais
- HistÃ³rias e herÃ³is

5.2 Pesquisa de Clima
DimensÃµes avaliadas:
- LideranÃ§a
- ComunicaÃ§Ã£o
- Desenvolvimento
- Reconhecimento
- Ambiente fÃ­sico

5.3 Engajamento
EstratÃ©gias:
- ComunicaÃ§Ã£o transparente
- Reconhecimento frequente
- Oportunidades de crescimento
- Autonomia e propÃ³sito
- EquilÃ­brio trabalho-vida

CONCLUSÃƒO
A gestÃ£o de pessoas Ã© fundamental para o sucesso organizacional no sÃ©culo XXI.
OrganizaÃ§Ãµes que investem em seus colaboradores colhem resultados superiores em
produtividade, inovaÃ§Ã£o e satisfaÃ§Ã£o dos clientes.
";

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
echo "ðŸ“š TESTE 1: ConteÃºdo Rico (3500+ caracteres)\n";
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n";

echo "ðŸ“Š EstatÃ­sticas do conteÃºdo:\n";
echo "   Caracteres: " . strlen($richContent) . "\n";
echo "   Palavras: ~" . str_word_count($richContent) . "\n";
echo "   MÃ³dulos mencionados: 5\n";
echo "\n";

$geminiService = app(\App\Services\GeminiAIService::class);

echo "ðŸš€ Gerando curso com Gemini otimizado...\n\n";

$startTime = microtime(true);

try {
    $courseData = $geminiService->generateCourseFromContent(
        $richContent,
        'GestÃ£o de Pessoas Completo',
        'Gestores e RH',
        'intermediate'
    );

    $elapsed = microtime(true) - $startTime;

    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n";
    echo "â•‘                  âœ… CURSO GERADO COM SUCESSO!                â•‘\n";
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";

    echo "â±ï¸  TEMPO DE GERAÃ‡ÃƒO: " . number_format($elapsed, 2) . "s\n\n";

    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
    echo "ðŸ“– ESTRUTURA DO CURSO GERADO\n";
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n";

    echo "ðŸ“š TÃ­tulo: " . ($courseData['title'] ?? 'N/A') . "\n";
    echo "ðŸ“ DescriÃ§Ã£o: " . substr($courseData['description'] ?? 'N/A', 0, 100) . "...\n";
    echo "â° Horas estimadas: " . ($courseData['estimated_hours'] ?? 0) . "h\n";
    echo "ðŸŽ¯ Dificuldade: " . ($courseData['difficulty'] ?? 'N/A') . "\n\n";

    $totalLessons = 0;
    $totalDuration = 0;
    $lessonTypes = [];

    echo "ðŸ“š MÃ“DULOS (" . count($courseData['modules'] ?? []) . "):\n";
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n";

    foreach (($courseData['modules'] ?? []) as $index => $module) {
        $moduleNum = $index + 1;
        $lessonsCount = count($module['lessons'] ?? []);
        $totalLessons += $lessonsCount;

        echo "ðŸ“˜ MÃ“DULO {$moduleNum}: " . ($module['title'] ?? 'N/A') . "\n";
        echo "   ðŸ“ " . substr($module['description'] ?? 'N/A', 0, 80) . "...\n";
        echo "   ðŸ“– LiÃ§Ãµes: {$lessonsCount}\n";

        // Mostrar primeiras 2 liÃ§Ãµes como exemplo
        foreach (array_slice($module['lessons'] ?? [], 0, 2) as $lessonIdx => $lesson) {
            $lessonNum = $lessonIdx + 1;
            $duration = $lesson['duration_minutes'] ?? 0;
            $type = $lesson['type'] ?? 'lesson';
            $points = $lesson['points'] ?? 0;

            $totalDuration += $duration;
            $lessonTypes[$type] = ($lessonTypes[$type] ?? 0) + 1;

            $typeEmoji = [
                'lesson' => 'ðŸ“–',
                'reading' => 'ðŸ“„',
                'quiz' => 'â“',
                'assignment' => 'âœï¸',
                'video' => 'ðŸŽ¥'
            ][$type] ?? 'ðŸ“Œ';

            echo "      {$typeEmoji} LiÃ§Ã£o {$lessonNum}: " . ($lesson['title'] ?? 'N/A') . "\n";
            echo "         â° {$duration}min | ðŸŽ¯ {$points} pts | ðŸ“ " . strlen($lesson['content'] ?? '') . " chars\n";
        }

        if ($lessonsCount > 2) {
            echo "      ... e mais " . ($lessonsCount - 2) . " liÃ§Ãµes\n";
        }

        echo "\n";
    }

    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
    echo "ðŸ“Š ESTATÃSTICAS FINAIS\n";
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n";

    echo "ðŸ“š Total de mÃ³dulos: " . count($courseData['modules'] ?? []) . "\n";
    echo "ðŸ“– Total de liÃ§Ãµes: {$totalLessons}\n";
    echo "â° DuraÃ§Ã£o total: {$totalDuration} minutos (~" . round($totalDuration / 60, 1) . " horas)\n";
    echo "ðŸŽ¯ Pontos totais: " . ($courseData['points_per_completion'] ?? 0) . "\n\n";

    echo "ðŸ“Š Tipos de liÃ§Ãµes:\n";
    foreach ($lessonTypes as $type => $count) {
        $percentage = round(($count / $totalLessons) * 100, 1);
        echo "   {$type}: {$count} ({$percentage}%)\n";
    }

    echo "\n";
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
    echo "âœ… VALIDAÃ‡ÃƒO DE QUALIDADE\n";
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n";

    $quality = [
        'modules_ok' => count($courseData['modules'] ?? []) >= 3,
        'lessons_ok' => $totalLessons >= 9,
        'duration_ok' => $totalDuration >= 60,
        'variety_ok' => count($lessonTypes) >= 2,
        'content_ok' => strlen($courseData['description'] ?? '') > 50
    ];

    foreach ($quality as $check => $passed) {
        $icon = $passed ? 'âœ…' : 'âŒ';
        $label = str_replace('_', ' ', ucfirst($check));
        echo "   {$icon} {$label}\n";
    }

    $passedChecks = count(array_filter($quality));
    $totalChecks = count($quality);
    $qualityScore = round(($passedChecks / $totalChecks) * 100, 1);

    echo "\n";
    echo "ðŸŽ¯ SCORE DE QUALIDADE: {$qualityScore}% ({$passedChecks}/{$totalChecks} critÃ©rios)\n\n";

    if ($qualityScore >= 80) {
        echo "ðŸ† EXCELENTE! Curso com alta qualidade!\n";
    } elseif ($qualityScore >= 60) {
        echo "ðŸ‘ BOM! Curso com qualidade aceitÃ¡vel.\n";
    } else {
        echo "âš ï¸  Curso precisa de melhorias.\n";
    }

    echo "\n";
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
    echo "ðŸ’¾ SALVANDO RESULTADO\n";
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n";

    $resultPath = storage_path('app/gemini_optimized_result.json');
    file_put_contents($resultPath, json_encode($courseData, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE));

    echo "âœ… Resultado salvo em:\n";
    echo "   {$resultPath}\n\n";

    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
    echo "ðŸ“ˆ COMPARAÃ‡ÃƒO: ANTES vs DEPOIS\n";
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n";

    echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n";
    echo "â”‚ MÃ‰TRICA                 â”‚ ANTES      â”‚ AGORA      â”‚\n";
    echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n";
    printf("â”‚ ConteÃºdo enviado        â”‚ %6s     â”‚ %6s     â”‚\n", "800ch", strlen($richContent) > 800 ? "15000ch" : strlen($richContent) . "ch");
    printf("â”‚ MÃ³dulos gerados         â”‚ %6d     â”‚ %6d     â”‚\n", 1, count($courseData['modules'] ?? []));
    printf("â”‚ LiÃ§Ãµes totais           â”‚ %6d     â”‚ %6d     â”‚\n", 4, $totalLessons);
    printf("â”‚ Temperatura             â”‚ %6.1f     â”‚ %6.1f     â”‚\n", 0.7, 0.9);
    printf("â”‚ Max tokens              â”‚ %6d     â”‚ %6d     â”‚\n", 8192, 32768);
    echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n";

    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n";
    echo "â•‘            ðŸŽ‰ OTIMIZAÃ‡ÃƒO CONCLUÃDA COM SUCESSO!              â•‘\n";
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";

    echo "ðŸš€ PRÃ“XIMOS PASSOS:\n";
    echo "   1. âœ… Gemini otimizado estÃ¡ funcionando!\n";
    echo "   2. ðŸŒ Teste na interface web com seu PDF\n";
    echo "   3. ðŸ“Š Compare a qualidade antes/depois\n\n";

    echo "ðŸ’¡ DICA: Use PDFs com TEXTO RICO para melhores resultados!\n\n";

} catch (\Exception $e) {
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n";
    echo "â•‘                     âŒ ERRO NO TESTE                         â•‘\n";
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";

    echo "Erro: " . $e->getMessage() . "\n\n";
    echo "Detalhes tÃ©cnicos:\n";
    echo "   Arquivo: " . $e->getFile() . "\n";
    echo "   Linha: " . $e->getLine() . "\n\n";

    exit(1);
}

exit(0);
