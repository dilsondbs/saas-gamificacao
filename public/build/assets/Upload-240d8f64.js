import{r as i,j as r,x as G,a as t,S as L,F as k,A as b}from"./app-2033c2ba.js";import{A as R}from"./AuthenticatedLayout-e732cd47.js";import{A as $}from"./ArrowLeftIcon-2722d9a6.js";import{C as K}from"./CheckCircleIcon-2012105e.js";import{E as J}from"./ExclamationTriangleIcon-0a42c3b9.js";import{C as y}from"./CloudArrowUpIcon-d8ff5991.js";import{D as I}from"./DocumentIcon-b0bd6cb4.js";import{S as P}from"./SparklesIcon-a102941b.js";import{A as O}from"./ArrowPathIcon-f174c421.js";import{T as V}from"./TrashIcon-ba2a360d.js";import"./ApplicationLogo-fbe97745.js";import"./transition-997472bc.js";function le({auth:j,course:c,materials:g=[],canGenerate:H=!1}){const[l,w]=i.useState(!1),[T,E]=i.useState(!1),[M,h]=i.useState(!1),[S,p]=i.useState(0),[d,f]=i.useState(null),[o,m]=i.useState({title:"",description:"",auto_generate:!0}),[C,n]=i.useState({}),[D,x]=i.useState(""),v=i.useCallback(e=>{e.preventDefault(),e.stopPropagation(),e.type==="dragenter"||e.type==="dragover"?h(!0):e.type==="dragleave"&&h(!1)},[]),_=i.useCallback(e=>{e.preventDefault(),e.stopPropagation(),h(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&A(e.dataTransfer.files[0])},[]),A=async e=>{if(!e)return;if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(e.type)&&!e.name.toLowerCase().match(/\.(pdf|doc|docx|txt|ppt|pptx)$/)){n({file:"Tipo de arquivo não suportado. Use PDF, DOC, DOCX, TXT, PPT ou PPTX."});return}if(e.size>10*1024*1024){n({file:"Arquivo muito grande. Tamanho máximo: 10MB."});return}if(f(e),n({}),!o.title){const s=e.name.replace(/\.[^/.]+$/,"");m(N=>({...N,title:s}))}},q=e=>{e.target.files&&e.target.files[0]&&A(e.target.files[0])},U=async e=>{if(e.preventDefault(),!d){n({file:"Selecione um arquivo para enviar."});return}if(!o.title.trim()){n({title:"O título é obrigatório."});return}w(!0),p(0),n({});try{const a=new FormData;a.append("material",d),a.append("title",o.title.trim()),a.append("description",o.description.trim()),a.append("auto_generate",o.auto_generate?"1":"0");const s=setInterval(()=>{p(B=>Math.min(B+10,90))},200),N=await fetch(route("materials.upload.store",c.id),{method:"POST",body:a,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}});clearInterval(s),p(100);const u=await N.json();if(u.success)x(u.message),f(null),m({title:"",description:"",auto_generate:!0}),setTimeout(()=>{u.redirect?window.location.href=u.redirect:b.reload()},1500);else throw new Error(u.error||"Erro no upload")}catch(a){console.error("Upload error:",a),n({general:a.message})}finally{w(!1),p(0)}},X=async e=>{E(!0);try{const s=await(await fetch(route("materials.generate",c.id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({material_id:e})})).json();if(s.success)x(s.message),setTimeout(()=>{s.redirect?window.location.href=s.redirect:b.visit(route("courses.show",c.id))},1500);else throw new Error(s.error||"Erro na geração")}catch(a){console.error("Generation error:",a),n({generation:a.message})}finally{E(!1)}},z=async e=>{if(confirm("Tem certeza que deseja excluir este material?"))try{const s=await(await fetch(route("materials.delete",e),{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();if(s.success)x(s.message),b.reload();else throw new Error(s.error||"Erro ao excluir")}catch(a){console.error("Delete error:",a),n({delete:a.message})}},F=e=>e>=1048576?(e/1048576).toFixed(2)+" MB":e>=1024?(e/1024).toFixed(2)+" KB":e+" bytes";return r(R,{user:j.user,header:r("div",{className:"flex items-center",children:[r(G,{href:route("courses.show",c.id),className:"mr-4 inline-flex items-center text-sm text-gray-500 hover:text-gray-700",children:[t($,{className:"h-4 w-4 mr-1"}),"Voltar ao Curso"]}),r("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:["Enviar Material - ",c.title]})]}),children:[t(L,{title:`Enviar Material - ${c.title}`}),t("div",{className:"py-12",children:r("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8 space-y-6",children:[D&&t("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:r("div",{className:"flex",children:[t(K,{className:"h-5 w-5 text-green-400"}),t("div",{className:"ml-3",children:t("p",{className:"text-sm font-medium text-green-800",children:D})})]})}),Object.keys(C).length>0&&t("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:r("div",{className:"flex",children:[t(J,{className:"h-5 w-5 text-red-400"}),t("div",{className:"ml-3",children:Object.entries(C).map(([e,a])=>t("p",{className:"text-sm font-medium text-red-800",children:a},e))})]})}),t("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:r("div",{className:"p-6",children:[r("div",{className:"flex items-center mb-6",children:[t(y,{className:"h-6 w-6 text-indigo-600 mr-2"}),t("h3",{className:"text-lg font-medium text-gray-900",children:"Enviar Novo Material"})]}),r("form",{onSubmit:U,className:"space-y-6",children:[r("div",{className:`relative border-2 border-dashed rounded-lg p-6 text-center transition-colors ${M?"border-indigo-400 bg-indigo-50":d?"border-green-400 bg-green-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:_,children:[t("input",{type:"file",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",accept:".pdf,.doc,.docx,.txt,.ppt,.pptx",onChange:q,disabled:l}),d?r("div",{className:"space-y-2",children:[t(I,{className:"mx-auto h-12 w-12 text-green-600"}),t("div",{className:"text-sm font-medium text-green-900",children:d.name}),t("div",{className:"text-xs text-green-600",children:F(d.size)}),t("button",{type:"button",onClick:()=>f(null),className:"text-xs text-red-600 hover:text-red-800",disabled:l,children:"Remover"})]}):r("div",{className:"space-y-2",children:[t(y,{className:"mx-auto h-12 w-12 text-gray-400"}),r("div",{className:"text-sm text-gray-600",children:[t("span",{className:"font-medium text-indigo-600",children:"Clique para enviar"})," ou arraste e solte"]}),t("p",{className:"text-xs text-gray-500",children:"PDF, DOC, DOCX, TXT, PPT, PPTX até 10MB"})]}),l&&r("div",{className:"mt-4",children:[t("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${S}%`}})}),r("p",{className:"text-xs text-gray-500 mt-1",children:["Enviando... ",S,"%"]})]})]}),r("div",{className:"grid md:grid-cols-2 gap-6",children:[r("div",{children:[t("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Título do Material *"}),t("input",{type:"text",id:"title",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Ex: Apostila de Python Básico",value:o.title,onChange:e=>m(a=>({...a,title:e.target.value})),disabled:l,required:!0})]}),r("div",{children:[t("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Descrição (Opcional)"}),t("input",{type:"text",id:"description",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Breve descrição do material",value:o.description,onChange:e=>m(a=>({...a,description:e.target.value})),disabled:l})]})]}),r("div",{className:"flex items-center",children:[t("input",{id:"auto_generate",type:"checkbox",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded",checked:o.auto_generate,onChange:e=>m(a=>({...a,auto_generate:e.target.checked})),disabled:l}),r("label",{htmlFor:"auto_generate",className:"ml-2 block text-sm text-gray-900",children:[r("div",{className:"flex items-center",children:[t(P,{className:"h-4 w-4 text-indigo-600 mr-1"}),"Gerar atividades automaticamente com IA"]}),t("p",{className:"text-xs text-gray-500 mt-1",children:"A IA analisará o material e criará atividades, quizzes e badges automaticamente"})]})]}),t("div",{className:"flex justify-end",children:t("button",{type:"submit",disabled:l||!d||!o.title.trim(),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:l?r(k,{children:[t(O,{className:"animate-spin h-4 w-4 mr-2"}),"Enviando..."]}):r(k,{children:[t(y,{className:"h-4 w-4 mr-2"}),"Enviar Material"]})})})]})]})}),g.length>0&&t("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:r("div",{className:"p-6",children:[r("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Materiais Enviados (",g.length,")"]}),t("div",{className:"space-y-4",children:g.map(e=>t("div",{className:"border border-gray-200 rounded-lg p-4",children:r("div",{className:"flex items-start justify-between",children:[r("div",{className:"flex-1 min-w-0",children:[t("h4",{className:"text-sm font-medium text-gray-900 truncate",children:e.title}),r("p",{className:"text-sm text-gray-500 mt-1",children:[e.file_name," • ",F(e.file_size)]}),e.description&&t("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),r("p",{className:"text-xs text-gray-400 mt-2",children:["Enviado em: ",new Date(e.created_at).toLocaleDateString("pt-BR")]})]}),r("div",{className:"flex items-center space-x-2 ml-4",children:[r("button",{onClick:()=>X(e.id),disabled:T,className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",children:[T?t(O,{className:"animate-spin h-3 w-3 mr-1"}):t(P,{className:"h-3 w-3 mr-1"}),"Gerar IA"]}),r("button",{onClick:()=>z(e.id),className:"inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-red-700 bg-red-100 hover:bg-red-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:[t(V,{className:"h-3 w-3 mr-1"}),"Excluir"]})]})]})},e.id))})]})}),g.length===0&&r("div",{className:"bg-gray-50 rounded-lg p-8 text-center",children:[t(I,{className:"mx-auto h-12 w-12 text-gray-400"}),t("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Nenhum material enviado"}),t("p",{className:"mt-1 text-sm text-gray-500",children:"Envie seu primeiro material para começar a gerar conteúdo automaticamente com IA."})]})]})})]})}export{le as default};
